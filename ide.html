<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WS3EQR | ULTIMATE IDE</title>
    
    <!-- ИКОНКИ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CODEMIRROR (Ядро редактора) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/scroll/simplescrollbars.css">
    
    <!-- ШРИФТЫ -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        /* --- 0. БАЗА --- */
        :root {
            --black: #000000;
            --dark-gray: #0a0a0a;
            --panel: #111111;
            --accent: #8a2be2; /* Фиолетовый неон */
            --accent-glow: rgba(138, 43, 226, 0.4);
            --text: #e0e0e0;
            --border: #222;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }
        
        body {
            background-color: var(--black);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            height: 100vh;
            overflow: hidden;
        }

        /* --- 1. ЗАГРУЗКА (GLITCH INTRO) --- */
        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--black); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease;
        }
        
        .glitch-logo {
            font-family: 'JetBrains Mono', monospace; font-size: 4rem; font-weight: 800;
            color: #fff; position: relative; letter-spacing: 5px;
            animation: glitch 1s infinite alternate;
        }
        
        .loading-bar {
            width: 200px; height: 2px; background: #333; margin-top: 20px;
            position: relative; overflow: hidden;
        }
        .loading-progress {
            position: absolute; left: 0; top: 0; height: 100%; width: 0%;
            background: var(--accent);
            box-shadow: 0 0 10px var(--accent);
            animation: load 2.5s forwards cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes glitch {
            0% { text-shadow: 2px 2px 0px #ff00ff, -2px -2px 0px #00ffff; }
            100% { text-shadow: -2px 2px 0px #ff00ff, 2px -2px 0px #00ffff; }
        }
        @keyframes load { 0% { width: 0%; } 100% { width: 100%; } }

        /* --- 2. ГЛАВНОЕ МЕНЮ (DASHBOARD) --- */
        #dashboard {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
            display: none; /* Скрыто по умолчанию */
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 5000; animation: fadeIn 0.5s ease;
        }

        .dash-container {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;
            max-width: 800px; width: 90%;
        }

        .dash-header {
            grid-column: span 2; text-align: center; margin-bottom: 30px;
        }
        .dash-header h1 { font-size: 2.5rem; letter-spacing: 2px; }
        .dash-header p { color: #666; font-family: 'JetBrains Mono'; }

        .dash-card {
            background: var(--panel); border: 1px solid var(--border);
            padding: 30px; border-radius: 12px; cursor: pointer;
            transition: all 0.3s ease; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 200px;
        }

        .dash-card:hover {
            border-color: var(--accent); transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .dash-card:hover i { color: var(--accent); transform: scale(1.1); text-shadow: 0 0 15px var(--accent); }

        .dash-card i { font-size: 3rem; margin-bottom: 15px; color: #444; transition: 0.3s; }
        .dash-card h3 { font-size: 1.2rem; margin-bottom: 5px; }
        .dash-card span { font-size: 0.8rem; color: #777; text-align: center; }

        /* --- 3. ИНТЕРФЕЙС IDE --- */
        #ide-interface {
            display: none; height: 100vh; flex-direction: column;
            animation: zoomIn 0.5s ease;
        }

        /* Верхняя панель */
        .top-bar {
            height: 45px; background: var(--dark-gray); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 20px; justify-content: space-between;
        }
        .logo-area { font-weight: 800; font-style: italic; color: #fff; letter-spacing: 1px; }
        
        .toolbar-actions { display: flex; gap: 10px; }
        .tool-btn {
            background: var(--panel); border: 1px solid var(--border);
            color: #ccc; padding: 6px 15px; border-radius: 4px; font-size: 0.8rem;
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 6px;
        }
        .tool-btn:hover { background: #333; color: #fff; }
        .btn-run { background: var(--accent); border: none; color: #fff; font-weight: bold; }
        .btn-run:hover { box-shadow: 0 0 15px var(--accent-glow); }

        /* Рабочая область */
        .workspace { flex: 1; display: flex; overflow: hidden; }

        /* Проводник */
        .sidebar {
            width: 260px; background: var(--panel); border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
        }
        .sidebar-title {
            padding: 15px; font-size: 0.75rem; color: #666; font-weight: bold;
            text-transform: uppercase; letter-spacing: 1px;
            display: flex; justify-content: space-between;
        }
        .file-list { flex: 1; overflow-y: auto; }
        .file-item {
            padding: 8px 20px; font-size: 0.9rem; color: #999; cursor: pointer;
            border-left: 2px solid transparent; display: flex; align-items: center; gap: 10px;
        }
        .file-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .file-item.active { background: rgba(138,43,226,0.1); border-left-color: var(--accent); color: #fff; }

        /* Редактор */
        .editor-container { flex: 1; display: flex; flex-direction: column; background: var(--black); }
        
        /* Вкладки */
        .tabs { display: flex; background: var(--dark-gray); height: 35px; overflow-x: auto; }
        .tab {
            padding: 0 20px; display: flex; align-items: center; gap: 8px; font-size: 0.85rem;
            color: #777; border-right: 1px solid var(--border); cursor: pointer;
            background: var(--dark-gray); min-width: 120px;
        }
        .tab.active { background: var(--black); color: #fff; border-top: 2px solid var(--accent); }
        .tab i { font-size: 0.8rem; }

        /* Сам редактор CodeMirror */
        .CodeMirror { height: 100% !important; background: var(--black) !important; font-family: 'JetBrains Mono'; font-size: 15px; }
        .CodeMirror-gutters { background: var(--black) !important; border-right: 1px solid #222; }

        /* Терминал */
        .terminal-panel {
            height: 200px; background: var(--panel); border-top: 1px solid var(--border);
            display: flex; flex-direction: column;
        }
        .term-header {
            padding: 5px 15px; background: #0f0f0f; font-size: 0.75rem; color: #888;
            border-bottom: 1px solid #222; display: flex; gap: 15px;
        }
        .term-content {
            flex: 1; padding: 15px; font-family: 'JetBrains Mono'; font-size: 0.9rem;
            overflow-y: auto; color: #ccc;
        }
        .log-line { margin-bottom: 4px; }
        .log-success { color: #50fa7b; }
        .log-error { color: #ff5555; }
        .log-info { color: #8be9fd; }

        /* Вспомогательные инпуты */
        input[type="file"] { display: none; }

        /* Анимации */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <!-- 1. ЗАГРУЗКА -->
    <div id="boot-screen">
        <div class="glitch-logo">WS3EQR IDE</div>
        <div class="loading-bar"><div class="loading-progress"></div></div>
        <div style="margin-top: 10px; color: #555; font-size: 0.8rem;">INITIALIZING CORE SYSTEMS...</div>
    </div>

    <!-- 2. МЕНЮ (DASHBOARD) -->
    <div id="dashboard">
        <div class="dash-container">
            <div class="dash-header">
                <h1>WELCOME BACK</h1>
                <p>Select an option to begin coding</p>
            </div>

            <!-- Кнопка: Новый проект -->
            <div class="dash-card" onclick="startNewProject()">
                <i class="fa-solid fa-code"></i>
                <h3>New Project</h3>
                <span>Create Python, Lua, or Web project</span>
            </div>

            <!-- Кнопка: Загрузить файл -->
            <div class="dash-card" onclick="triggerUpload()">
                <i class="fa-solid fa-upload"></i>
                <h3>Open File</h3>
                <span>Upload .py, .lua, .js from PC</span>
            </div>

            <!-- Кнопка: Шаблоны -->
            <div class="dash-card" onclick="loadTemplate()">
                <i class="fa-solid fa-layer-group"></i>
                <h3>Templates</h3>
                <span>Load WS3EQR Standard Boilerplate</span>
            </div>

            <!-- Кнопка: GitHub -->
            <div class="dash-card" style="opacity: 0.5;">
                <i class="fa-brands fa-github"></i>
                <h3>Clone Repo</h3>
                <span>(Coming Soon)</span>
            </div>
        </div>
    </div>

    <!-- 3. IDE ИНТЕРФЕЙС -->
    <div id="ide-interface">
        <!-- Тулбар -->
        <div class="top-bar">
            <div class="logo-area"><i class="fa-solid fa-cube" style="color:var(--accent)"></i> WS3EQR STUDIO</div>
            <div class="toolbar-actions">
                <button class="tool-btn" onclick="returnToMenu()"><i class="fa-solid fa-house"></i> MENU</button>
                <button class="tool-btn" onclick="triggerUpload()"><i class="fa-solid fa-folder-open"></i> OPEN</button>
                <button class="tool-btn" onclick="downloadFile()"><i class="fa-solid fa-download"></i> EXPORT</button>
                <button class="tool-btn btn-run" onclick="runCode()"><i class="fa-solid fa-play"></i> RUN</button>
            </div>
        </div>

        <!-- Рабочая зона -->
        <div class="workspace">
            <!-- Сайдбар -->
            <div class="sidebar">
                <div class="sidebar-title">
                    <span>EXPLORER</span>
                    <i class="fa-solid fa-plus" style="cursor:pointer; color:#fff" onclick="createNewFile()" title="New File"></i>
                </div>
                <div class="file-list" id="file-list-container">
                    <!-- Файлы генерируются JS -->
                </div>
            </div>

            <!-- Редактор -->
            <div class="editor-container">
                <div class="tabs" id="tabs-container">
                    <!-- Вкладки генерируются JS -->
                </div>
                <textarea id="code-editor"></textarea>
            </div>
        </div>

        <!-- Терминал -->
        <div class="terminal-panel">
            <div class="term-header">
                <span style="color:#fff">TERMINAL</span>
                <span>OUTPUT</span>
                <span>DEBUG CONSOLE</span>
            </div>
            <div class="term-content" id="terminal">
                <div class="log-line">WS3EQR Shell v3.0.1 Ready...</div>
                <div class="log-line" style="color: #666">Type code and press RUN to execute.</div>
                <br>
            </div>
        </div>
    </div>

    <!-- СКРЫТЫЙ INPUT ДЛЯ ЗАГРУЗКИ ФАЙЛОВ -->
    <input type="file" id="file-upload" onchange="handleFileSelect(this)">

    <!-- СКРИПТЫ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/lua/lua.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>

    <script>
        // --- ДАННЫЕ ---
        let editor;
        let files = {};
        let activeFileName = '';

        // --- 1. ЗАГРУЗКА И ВХОД ---
        window.onload = () => {
            // Эмуляция загрузки ядра
            setTimeout(() => {
                document.getElementById('boot-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('boot-screen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'flex';
                }, 800);
            }, 2500);

            // Инициализация CodeMirror
            editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
                theme: "dracula",
                lineNumbers: true,
                indentUnit: 4,
                mode: "python"
            });
            
            editor.on('change', () => {
                if(activeFileName && files[activeFileName]) {
                    files[activeFileName].content = editor.getValue();
                }
            });
        };

        // --- 2. УПРАВЛЕНИЕ МЕНЮ ---
        
        function startNewProject() {
            // Создаем чистый проект
            files = {
                'main.py': { content: "# New Project\nprint('Hello World')", lang: 'python', icon: 'fa-brands fa-python' }
            };
            openIde('main.py');
            logToTerm("Created new Python project.", "log-success");
        }

        function loadTemplate() {
            files = {
                'main.lua': { content: "-- Roblox Script Template\nlocal part = Instance.new('Part')\npart.Parent = workspace\nprint('Part created!')", lang: 'lua', icon: 'fa-solid fa-moon' },
                'config.json': { content: "{\n  \"version\": \"1.0\",\n  \"author\": \"ws3eqr\"\n}", lang: 'javascript', icon: 'fa-solid fa-gear' },
                'readme.md': { content: "# Project Info\nCreated in WS3EQR IDE", lang: 'xml', icon: 'fa-solid fa-file' }
            };
            openIde('main.lua');
            logToTerm("Template loaded successfully.", "log-success");
        }

        function returnToMenu() {
            document.getElementById('ide-interface').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';
        }

        function openIde(fileNameToOpen) {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('ide-interface').style.display = 'flex';
            renderExplorer();
            switchFile(fileNameToOpen);
        }

        // --- 3. ФАЙЛОВАЯ СИСТЕМА ---

        function renderExplorer() {
            const container = document.getElementById('file-list-container');
            const tabsContainer = document.getElementById('tabs-container');
            container.innerHTML = '';
            tabsContainer.innerHTML = '';

            Object.keys(files).forEach(fname => {
                // Сайдбар
                const div = document.createElement('div');
                div.className = `file-item ${activeFileName === fname ? 'active' : ''}`;
                div.innerHTML = `<i class="${files[fname].icon}"></i> ${fname}`;
                div.onclick = () => switchFile(fname);
                container.appendChild(div);

                // Вкладки
                const tab = document.createElement('div');
                tab.className = `tab ${activeFileName === fname ? 'active' : ''}`;
                tab.innerHTML = `<i class="${files[fname].icon}"></i> ${fname}`;
                tab.onclick = () => switchFile(fname);
                tabsContainer.appendChild(tab);
            });
        }

        function switchFile(fname) {
            activeFileName = fname;
            const file = files[fname];
            
            // Определяем режим подсветки
            let mode = 'python';
            if(file.lang === 'lua') mode = 'lua';
            if(file.lang === 'javascript') mode = 'javascript';
            if(file.lang === 'html') mode = 'htmlmixed';

            editor.setOption("mode", mode);
            editor.setValue(file.content);
            renderExplorer();
        }

        function createNewFile() {
            const name = prompt("File name (e.g. test.js):");
            if(name) {
                let lang = 'python';
                let icon = 'fa-solid fa-file';
                
                if(name.endsWith('.js')) { lang = 'javascript'; icon = 'fa-brands fa-js'; }
                if(name.endsWith('.lua')) { lang = 'lua'; icon = 'fa-solid fa-moon'; }
                if(name.endsWith('.html')) { lang = 'html'; icon = 'fa-brands fa-html5'; }
                if(name.endsWith('.py')) { lang = 'python'; icon = 'fa-brands fa-python'; }

                files[name] = { content: "", lang: lang, icon: icon };
                switchFile(name);
                logToTerm(`File ${name} created.`, "log-info");
            }
        }

        // --- 4. ЗАГРУЗКА И СОХРАНЕНИЕ (ФУНКЦИОНАЛ) ---

        function triggerUpload() {
            document.getElementById('file-upload').click();
        }

        function handleFileSelect(input) {
            const file = input.files[0];
            if(!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const name = file.name;
                
                // Определяем тип
                let lang = 'python';
                let icon = 'fa-solid fa-file';
                if(name.endsWith('.js')) { lang = 'javascript'; icon = 'fa-brands fa-js'; }
                if(name.endsWith('.lua')) { lang = 'lua'; icon = 'fa-solid fa-moon'; }
                if(name.endsWith('.html')) { lang = 'html'; icon = 'fa-brands fa-html5'; }

                files[name] = { content: content, lang: lang, icon: icon };
                
                // Если мы были в меню, идем в IDE
                if(document.getElementById('dashboard').style.display !== 'none') {
                    openIde(name);
                } else {
                    switchFile(name);
                }
                logToTerm(`File ${name} imported from disk.`, "log-success");
            };
            reader.readAsText(file);
        }

        function downloadFile() {
            const file = files[activeFileName];
            const blob = new Blob([file.content], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = activeFileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            logToTerm(`Exported ${activeFileName} to Downloads.`, "log-success");
        }

        // --- 5. КОМПИЛЯЦИЯ ---

        function runCode() {
            const term = document.getElementById('terminal');
            logToTerm(`> Executing ${activeFileName}...`, "log-info");
            
            setTimeout(() => {
                if(activeFileName.endsWith('.py')) {
                    if(editor.getValue().includes('print')) {
                        logToTerm("Hello World!", ""); 
                    }
                    logToTerm("Process finished with exit code 0", "log-success");
                } 
                else if(activeFileName.endsWith('.html')) {
                    logToTerm("Starting Live Server on port 5500...", "log-info");
                    logToTerm("Opening browser preview...", "log-success");
                }
                else {
                    logToTerm("Script executed successfully.", "log-success");
                }
                term.scrollTop = term.scrollHeight;
            }, 600);
        }

        function logToTerm(msg, className) {
            const term = document.getElementById('terminal');
            const div = document.createElement('div');
            div.className = `log-line ${className}`;
            div.innerText = msg;
            term.appendChild(div);
            term.scrollTop = term.scrollHeight;
        }

    </script>
</body>
</html>
